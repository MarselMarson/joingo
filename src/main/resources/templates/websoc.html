<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test with SockJS and STOMP</title>
    <style>
        #messages {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>WebSocket Test with SockJS and STOMP</h1>

<button id="connect">Connect to WebSocket</button>
<button id="subscribe" disabled>Subscribe to Topic</button>

<div>
    <input type="text" id="message" placeholder="Enter your message" />
    <button id="send" disabled>Send Message</button>
</div>

<div id="messages">
    <h3>Received Messages:</h3>
</div>

<!-- Подключение SockJS и STOMP.js через CDN -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    let stompClient = null;

    document.getElementById('connect').onclick = function() {
        const socket = new SockJS('http://localhost:8443/ch');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
            console.log('Connected: ' + frame);
            document.getElementById('subscribe').disabled = false;
            document.getElementById('send').disabled = false;
        });
    };

    document.getElementById('subscribe').onclick = function() {
        stompClient.subscribe('/topic/messages', function(messageOutput) {
            const message = JSON.parse(messageOutput.body);
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML += '<p><strong>Received:</strong> ' + message.content + '</p>';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    };

    document.getElementById('send').onclick = function() {
        const chatMessage = {
            chatId: 1,
            senderId: 1001,
            recipientId: 1002,
            content: document.getElementById('message').value
        };
        stompClient.send("/app/chat", {}, JSON.stringify(chatMessage));
        document.getElementById('message').value = '';
    };
</script>
</body>
</html>